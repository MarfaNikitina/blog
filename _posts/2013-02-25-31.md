---
layout: post
title:  "Работа с Яндекс.Диском из 1С"
date:   "2013-02-25 05:10:38"
permalink: /2013/02/25/1/
categories: Программирование Яндекс 1С производство
---
1С умеет удивлять. Например, чтобы работать с Яндекс.Диском, не требуется никакого шаманства, все из коробки:
[[html <pre><code>
Путь1 = "https://login:pass@webdav.yandex.ru/path/to/file.txt";
Путь2 = "c:\file.txt";
КопироватьФайл(Путь1, Путь2);
УдалитьФайлы(Путь1);
КопироватьФайл(Путь2, Путь1);
</code></pre>]]
Данный код копирует файл из облака Яндекса на локальный диск, удаляет из облака и заливает обратно.
Вместо **login** и **pass** подставляем логин и пароль Яндекса.

Это дико удобно, потому что, в отличии от Дропбокса, Яндекс поддерживает Вебдав.
Диск от Яндекса раскачивается до 10 Гб в полпинка. Таким образом, все прайсы, фотки и прочую статику можно хранить в диске от Яндекса.



#### Комментарии из старого блога


**04/17/13 Руслан:** Приветствую, ну а что удивительного. Я так понимаю яндекс диск резервирует служебную папку. КопироватьФайл - просто копирует в эту папку файл, а яндекс приблуда висячая в трее, сама синхранизирует данные.

Пробовали сделать данный не шаманский код, без установленного яндекс диск по?


**04/18/13 Иван Гришаев:** Код работает без установленного Я.Диска. В 1С где-то зашита поддержка протокола Вебдав, по которому работает Я.Диск. ФТП тоже поддерживается. В том и прикол, что для работы с файлами из облака устанавливать клиент не нужно.




**04/18/13 Руслан:** Ну тогда действительно прикольная штука. Надо по экспериментировать ;)





**08/03/13 Илья:** А уверены, что именно 1С поддерживает webDAV а не ОС?
Попробуйте под ХР запустить этот код


**08/03/13 Иван Гришаев:** Уверен, так написано в доках. А что, под Икс-пи не работает?




**12/23/13 Александр Маляев:** Огромное спасибо за наводку! А то никак не мог придумать, куда бы свои 500Гб на Яндексе приспособить. А тут mail.ru еще облако замутило и терабайт в подарок всем дало, и WebDAV скоро обещают - вообще тема будет!


**01/16/14 Иван Гришаев:** У мейл.ру подвох в том, что все залитые данные становятся их собственностью, они могут делать с ними все, что хотят. Например, слить бекапы ваших баз конкурентам. Разве что на архив выставлять пароль.





**01/16/14 Александр Маляев:** Вы сами понимаете что они это делать не будут. Всего один прецедент, и его так раструбят по всем соцсетям и новостным лентам, что потом не отмоешься. А при миллиардных оборотах так глупо рисковать своей репутацией ради каких-то копеечных архивов? Техподдержка MAIL.RU уже отвечала на этот вопрос, дав понять что этот пункт просто формальность. Конечно все мы понимаем что если спецслужбам понадобятся материалы то любой их предоставит, и MAIL.RU не исключение, но многим ли есть повод скрывать что-то от высокопоставленных органов? Мелкие нарушения в налоговом законодательстве никого не волнуют ни капли. За много лет моей работы сотни архивов баз и паролей ко всему прошли через почту, файлообменники, СМС - и ничего. А уж почта не менее доступна кому надо чем облака.


**01/16/14 Иван Гришаев:** Снимите розовые очки. Номера телефонов продают спамерам все. Мейл ру могут слить ваши данные, потому что вы не сможете явно доказать, что слили именно они. Вручную они не буду рыться в ваших данных, скорее, это делает программа, которая ищет во всей этой помойке что-то интересное. Базы от 1С интересны, их можно тайком продавать.





**01/16/14 Александр Маляев:** Да, кстати в 1С 7.7 такой поддержки WebDAV нет.





**02/27/14 Виталий:** А есть ли возможность из 1С8 получить публичную ссылку на скопированный файл.


**02/27/14 Иван Гришаев:** Нет, только средствами Я.Диска.





**03/16/15 Андрей:** А куда этот код надо прописать? и как без ПО яндекс.Диска настраивать путь к базе из самой 1с?


**03/16/15 Иван Гришаев:** Этот код вы помещаете в любое место, например, в тело формы, модуля.
Вторую часть вопроса не понял.





**03/16/15 Андрей:** Подскажите можно настроить доступ к яндекс.диску путем
https://login:pass@webdav.yandex.ru/path/to/file.txt 
т.е при выборе пути к БД что указывать? эту строку?
как работает такой доступ?


**03/16/15 Иван Гришаев:** Андрей, мне кажется, вы не так поняли. БД тут ни при чем.
Предположим, что в Я-диске у вас есть папка documents, а в ней файл price.xls.
И предположим, что ваш Я-логин andrey, a пароль Super123
Тогда вы можете выкачать файл из Я-диска прямо из кода 1с таким образом
КопироватьФайл("https://andrey:Super123@webdav.yandex.ru/documents/price.xls", "c:\documents\price.xls");

или наоборот, загрузить файл с локального диска в Я-диск
КопироватьФайл("c:\documents\price.xls", "https://andrey:Super123@webdav.yandex.ru/documents/price.xls");

Проблема только в том, что в последних билдах 1С стал глючить SSL




**03/16/15 Андрей:** А как подключить яндекс диске(с базой 1С) она будет работать?
в настройках указать путь к БД 1с какой ? с дисками локальными все понятно а как быть с Яндекс дискам? можно подключить диск командой https://login:pass@webdav.yandex.ru?
или нет?
просто хочу организовать доступ не локальный(БД не на компе), а скажем через яндекс диск.
Это возможно ?


**03/16/15 Иван Гришаев:** Андрей, вы можете синхронизировать файл базы через Я-диск только когда не работаете с ней. Когда вы начинаете работу, файл открывается процессом 1С и сторонние процессы не смогут его прочитать. Кроме того, если много клиентов постоянно перезаписывают один и тот же файл, могут возникнуть конфликты, и чья-то сторона вынуждена будет принять не свои данные. Если вам нужна единая база данных, воспользуйтесь хостингами вроде virtual1c.net




**03/16/15 Александр Маляев:** Андрей, теоретически это возможно, так как удаленную Webdav-папку можно смонтировать как локальный диск и работать с ней как с обычным диском. Но фактически вы работать не сможете, т.к. скорость будет примерно такая как если бы вы умудрились запустить 1С на каком-нибудь древнем 286-ом.

Если хотите удаленную а не локальную 1С - то смотрите в сторону "облаков", в случае этого решения и данные и их обработка происходят на одном удаленном сервере, клиенту "гонится" либо картинка (в случае удаленного рабочего стола), либо небольшие куски данных, отобранные и обработанные сервером (в случае тонкого клиента).





**04/29/15 Алексей:** Подскажите пожалуйста, доводилось ли Вам получать с ЯндексДиск штатными средствами 1С 8.3 список файлов в произвольной папке? Без подключения внешних XML библиотек ?
Все пишут, что надо сделать запрос (даже без тела), указав только атрибуты (заголовки объекта HTTPЗапрос):
PROPFIND / HTTP/1.1 
Host: webdav.yandex.ru 
Accept: */* 
Depth: 0
Authorization: Basic "+ВКодировкеBase64(ЛогинПароль:ИмяФайла)
Но, "PROPFIND / HTTP/1.1 " - это ведь не атрибут, это команда. И как тогда её выполнить штатными средствами 1С?


**04/29/15 Иван Гришаев:** Здравствуйте, не приходилось.
Нужно смотреть документацию, позволяет ли 1С отправить хттп-запрос методом PROPFIND.
Если нет, то увы.

Проверьте, можно ли передать урл Яндекс-диска в функцию НайтиФайлы()
Если тоже нет, установите cURL из запускайте его из 1С как процесс.
Текст ответа распарсите силами 1с







**11/20/15 Сергей Лиманчук:** Иван, всё прекрасно работало где-то полгода, но с середины вчерашнего дня не копирует никакие файлы, 1С возвращает ошибку "Удаленный узел не прошел проверку". Любопытно, что мобильное приложение 1С  для iOS продолжает работать, ошибка вылезает только на ПК.


**11/20/15 Иван Гришаев:** Сергей, да, с какого-то времени схема перестала работать, к сожалению. Вы можете заменить диск от Яндекса на ФТП-сервер. Все то же самое, только в файловом пути пишете ftp:// вместо https://




