<!DOCTYPE html>
<html lang="en"

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>User-Agent parser for Clojure</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="http://grishaev.me/en/user-agent/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="http://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

</head>


  <body>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-33533163-2', 'auto');
    ga('send', 'pageview');

</script>

    <header class="site-header">

    <style>

        .search-button {
            border: none;
            background-color: transparent;
            cursor: pointer;
        }

        .flex-container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }

        .flex-container-vert {
            display: flex;
            flex-direction: column;
        }

        .menu-item {
            text-decoration: none;
            font-size: 14pt;
            margin-right: 25px;
        }

        .menu-item:hover {
            text-decoration: underline;
        }

        .minor {
            color: black;
            font-size: 12pt;
            margin-right: 20px;
        }

        .minor:visited {
            color: inherit;
        }

    </style>

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img src="/assets/static/photo-round-small.png">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container" style="justify-content: space-between">

                <div>
                    <div class="flex-container">
                        <p style="margin-bottom: 5px">
                            Ivan Grishaev's blog
                            <br>
                            <small>Writing on programming, education, books and negotiations.
</small>
                        </p>
                    </div>
                </div>

                <div>
                    <form method="get" action="/search/">
                        <div class="flex-container">
                            <input name="q" placeholder="Поиск">
                            <button class="search-button" type="submit">&#x1f50d;</button>
                        </div>
                    </form>
                </div>

            </div>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">User-Agent parser for Clojure</h1>
    <p class="post-meta">
      <time datetime="2018-09-29T00:00:00+00:00" itemprop="datePublished">Sep 29, 2018</time>

      

      <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>
    </p>

    <script src="https://yastatic.net/es5-shims/0.0.2/es5-shims.min.js"></script>
<script src="https://yastatic.net/share2/share.js"></script>
<div class="ya-share2" data-services="twitter,telegram,facebook,vkontakte,lj,evernote,linkedin,reddit" data-limit="4"></div>


  </header>

  <div class="post-content" itemprop="articleBody">
    
<p>Today, I detached another chunk of my codebase into a <a href="https://github.com/igrishaev/user-agent">separate library</a>. This time, it is for parsing User-Agent headers with Clojure. For a long time, I’ve been copying it from project to project, but now I decided to keep it aside from the code because it is not connected to the business logic. All the technical stuff that is not related to the very problem we are trying to solve should be kept as a separate library, I believe. The main code is all about the business problem.</p>

<p>The library ships only one function, which is <code class="highlighter-rouge">parse</code>. It takes a string and returns a detailed map with information about the browser’s type, its version, manufacturer, operating system, etc. The library relies on good old Java <a href="http://uadetector.sourceforge.net/">UA Detector</a> with the latest set of patterns. I know, there are already some solutions for that. But they either do not provide full information about a user or maintainers do not accept pull requests.</p>

<p>Add it to your project:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">:dependencies</span><span class="w"> </span><span class="p">[[</span><span class="n">user-agent</span><span class="w"> </span><span class="s">"0.1.0-SNAPSHOT"</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<p>Usage:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">some.ns</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">user-agent</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">ua</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">ua-sample</span><span class="w">
  </span><span class="s">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="nf">ua/parse</span><span class="w"> </span><span class="n">ua-sample</span><span class="p">)</span><span class="w">

</span><span class="p">{</span><span class="no">:producer</span><span class="w"> </span><span class="s">"Google Inc."</span><span class="w">
 </span><span class="no">:family</span><span class="w"> </span><span class="no">:CHROME</span><span class="w">
 </span><span class="no">:name</span><span class="w"> </span><span class="s">"Chrome"</span><span class="w">
 </span><span class="no">:type</span><span class="w"> </span><span class="no">:BROWSER</span><span class="w">
 </span><span class="no">:icon</span><span class="w"> </span><span class="s">"chrome.png"</span><span class="w">
 </span><span class="no">:producer-url</span><span class="w"> </span><span class="s">"http://www.google.com/"</span><span class="w">
 </span><span class="no">:url</span><span class="w"> </span><span class="s">"http://www.google.com/chrome"</span><span class="w">
 </span><span class="no">:device</span><span class="w"> </span><span class="p">{</span><span class="no">:category</span><span class="w"> </span><span class="no">:PERSONAL_COMPUTER</span><span class="w">
          </span><span class="no">:name</span><span class="w"> </span><span class="s">"Personal computer"</span><span class="p">}</span><span class="w">
 </span><span class="no">:os</span><span class="w">
 </span><span class="p">{</span><span class="no">:family</span><span class="w"> </span><span class="no">:OS_X</span><span class="w">
  </span><span class="no">:family-name</span><span class="w"> </span><span class="s">"OS X"</span><span class="w">
  </span><span class="no">:name</span><span class="w"> </span><span class="s">"OS X"</span><span class="w">
  </span><span class="no">:producer</span><span class="w"> </span><span class="s">"Apple Computer, Inc."</span><span class="w">
  </span><span class="no">:producer-url</span><span class="w"> </span><span class="s">"http://www.apple.com/"</span><span class="w">
  </span><span class="no">:url</span><span class="w"> </span><span class="s">"http://en.wikipedia.org/wiki/Mac_OS_X"</span><span class="w">
  </span><span class="no">:version</span><span class="w">
  </span><span class="p">{</span><span class="no">:bug-fix</span><span class="w"> </span><span class="s">"6"</span><span class="w">
   </span><span class="no">:extension</span><span class="w"> </span><span class="s">""</span><span class="w">
   </span><span class="no">:groups</span><span class="w"> </span><span class="p">[</span><span class="s">"10"</span><span class="w"> </span><span class="s">"11"</span><span class="w"> </span><span class="s">"6"</span><span class="p">]</span><span class="w">
   </span><span class="no">:major</span><span class="w"> </span><span class="s">"10"</span><span class="w">
   </span><span class="no">:minor</span><span class="w"> </span><span class="s">"11"</span><span class="w">
   </span><span class="no">:version</span><span class="w"> </span><span class="s">"10.11.6"</span><span class="p">}}</span><span class="w">
 </span><span class="no">:type-name</span><span class="w"> </span><span class="s">"Browser"</span><span class="w">
 </span><span class="no">:version</span><span class="w">
 </span><span class="p">{</span><span class="no">:bug-fix</span><span class="w"> </span><span class="s">"3396"</span><span class="w">
  </span><span class="no">:extension</span><span class="w"> </span><span class="s">""</span><span class="w">
  </span><span class="no">:groups</span><span class="w"> </span><span class="p">[</span><span class="s">"67"</span><span class="w"> </span><span class="s">"0"</span><span class="w"> </span><span class="s">"3396"</span><span class="w"> </span><span class="s">"99"</span><span class="p">]</span><span class="w">
  </span><span class="no">:major</span><span class="w"> </span><span class="s">"67"</span><span class="w">
  </span><span class="no">:minor</span><span class="w"> </span><span class="s">"0"</span><span class="w">
  </span><span class="no">:version</span><span class="w"> </span><span class="s">"67.0.3396.99"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p>It supports plenty of desktop and mobile browsers as well as unusual ones like bots, crawlers or TVs. Hope you’ll enjoy it, your suggestions and PR’s are welcome.</p>

  </div>

</article>

<div id="disqus_thread"></div>
<script>
    /**
    * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');

    s.src = '//igrishaev.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/igrishaev"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">igrishaev</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/i_grishaev"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">i_grishaev</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
