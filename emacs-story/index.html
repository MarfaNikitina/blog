<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Рассказ о Емаксе</title>
  <meta name="description" content="В прошлый четверг я рассказывал аудитории Хекслета проЕмакс. Представляю читателям блога скомпилированную версию выступления. Рассказпересекается с прошлой з...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="http://grishaev.me/emacs-story/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="http://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

</head>


  <body>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-33533163-2', 'auto');
    ga('send', 'pageview');

</script>

    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img src="/assets/static/photo-round-small.png" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title" itemprop="name headline">Рассказ о Емаксе</h1>

    
<div class="post-meta">

    <time class="post-time"
          datetime="2016-06-11T00:00:00+00:00">
        Jun 11, 2016
    </time>

    <a href="/tag/emacs/" rel="tag">emacs</a>

</div>

    <script src="https://yastatic.net/es5-shims/0.0.2/es5-shims.min.js"></script>
<script src="https://yastatic.net/share2/share.js"></script>
<div class="ya-share2" data-services="twitter,telegram,facebook,vkontakte,lj,evernote,linkedin,reddit" data-limit="4"></div>


  </header>

  <div class="post-content" itemprop="articleBody">
    <p>В прошлый четверг <a href="/hexlet-emacs">я рассказывал</a> аудитории Хекслета про
Емакс. Представляю читателям блога скомпилированную версию выступления. Рассказ
пересекается с <a href="/emacs">прошлой заметкой</a> о Емаксе.</p>

<p>Сказанное ниже носит общий характер. Это не мануал и не инструкция с шагами что
скачать и куда положить. За этими вопросами пройдите по ссылкам в конце.</p>

<p><img src="/assets/static/emacs/throne.jpg" alt="throne" /></p>

<p><em>Кадр из фильма Трон: наследие. Хакер взламывает кого-то при помощи Емакса. Ему
помогают запущенный тетрис и игра-головоломка о перестановке пирамиды.</em></p>

<h2>

    Содержание

</h2>

<ul id="toc-item-emacs-story">
  <li><a href="#Историческая-часть" id="toc-item-emacs-story-Историческая-часть">Историческая часть</a></li>
  <li><a href="#Отличие-от-Вима" id="toc-item-emacs-story-Отличие-от-Вима">Отличие от Вима</a></li>
  <li><a href="#Философия-Емакса" id="toc-item-emacs-story-Философия-Емакса">Философия Емакса</a></li>
  <li><a href="#Недостатки-Когда-не-следует-использовать-Емакс" id="toc-item-emacs-story-Недостатки-Когда-не-следует-использовать-Емакс">Недостатки. Когда не следует использовать Емакс</a></li>
  <li><a href="#Достоинства" id="toc-item-emacs-story-Достоинства">Достоинства</a></li>
  <li><a href="#Как-я-переходил-на-Емакс-Трудности-мотивация" id="toc-item-emacs-story-Как-я-переходил-на-Емакс-Трудности-мотивация">Как я переходил на Емакс. Трудности, мотивация</a></li>
  <li><a href="#Установка" id="toc-item-emacs-story-Установка">Установка</a></li>
  <li><a href="#Основные-положения" id="toc-item-emacs-story-Основные-положения">Основные положения</a></li>
  <li><a href="#Конфигурирование" id="toc-item-emacs-story-Конфигурирование">Конфигурирование</a></li>
  <li><a href="#Коротко-о-пакетах" id="toc-item-emacs-story-Коротко-о-пакетах">Коротко о пакетах</a></li>
  <li><a href="#Сборки-форки" id="toc-item-emacs-story-Сборки-форки">Сборки, форки</a></li>
  <li><a href="#Для-чего-я-использую-Емакс" id="toc-item-emacs-story-Для-чего-я-использую-Емакс">Для чего я использую Емакс</a></li>
  <li><a href="#Ресурсы" id="toc-item-emacs-story-Ресурсы">Ресурсы</a></li>
</ul>

<h3 id="Историческая-часть">Историческая часть</h3>

<p>Емакс – это старенький текстовый редактор. Ричард Столлман начал работать над
ним примерно 40 лет назад. Задумайтесь, как это много – больше, чем средний
возраст популярных ресурсов. Емакс – одна из самых старых программ в
айти-индустрии и все еще остается в строю.</p>

<p>Первоначально это были отдельные скрипты на Лиспе для операций с текстом. Позже
Столлман оформил их в отдельную программу. Емакс состоит из двух частей. Это
маленькое ядро, написанное на Си. Ядро отвечает за ввод-вывод и отрисовку
окон. Вторая часть – код на Лиспе для манипуляции с текстом.</p>

<p>В Емаксе используется собственный диалект Лиспа, называемый Elisp (не путать с
EMACS Lisp – это совсем другой диалект). Столлман отверг Common Lisp как
излишне усложненный диалект, а Scheme – как недостаточно мощный. Так появилась
своя реализация.</p>

<p>Технически Elisp имеет серьезные ограничения – никакой многопоточности, нет
хвостовой рекурсии, трудности с замыканиями. Производительность его очень
невысока, примерно как Питон или Руби старых версий. Однако, даже при всех
недостатках языка в нем можно творить потрясные вещи – редактировать код,
управлять процессами, читать новости, RSS, играть в игры и так далее.</p>

<p>Известная шутка о том, что емакс – это операционная система, в которой нет
нормального редактора, косвенно права. Емакс можно рассматривать как рантайм
программ, написанных на ELisp. Примерно как Хром – среда исполнения
Джаваскрипта.</p>

<p>Емакс обязан успехом исключительно Лиспу. Многие пакеты были написаны 10-20 лет
назад, но по-прежнему разрабатываются, проходят рефакторинг.</p>

<p>Подобно Лиспу, у Емакса есть форки и ответвления. Так, в девяностых годах
обанкротилась компания Lucid, программисты которой использовали Емакс. Они
взрастили внутри компании независимую версию редактора. Случилось так, что
разработчики не договорились о правах и лицензиях. Так появился XEmacs – своего
рода улучшенный Емакс. О форках я расскажу ниже.</p>

<p>Подведя черту, можно сказать, что Емакс прошел сорокалетний путь развития и
активно используется программистами сегодня. За этот срок написаны сотни статей,
десятки книг и мануалов. Начать пользоваться Емаксом легко – в него встроен
хороший туториал, на борту большой раздел документации.</p>

<h3 id="Отличие-от-Вима">Отличие от Вима</h3>

<p>Эти два редактора часто сравнивают друг с другом. Между ними много общего, но
есть и расхождения. Так, оба редактора поощряют отказ от мыши, слепой набор,
автоматизацию действий, не привязывают к конкретному языку, как ИДЕ.</p>

<p>Различия скорее идеологические. Вим следует философии Юникса, стараясь делать
одну задачу, но хорошо – редактировать текст. За счет режимов и общей механике
большинство операций в Виме делаются быстрее. В каждом режиме клавиша имеет
разную функцию. Комбинации становятся емче, нужно меньше клавиш, чтобы задать
комбо.</p>

<p>В Емаксе нет режимов из коробки, поэтому комбинации нуждаются в дополнительных
клавишах (Комманд и Мета), чтобы различать ввод текста и команды. Это делает
комбинации не такими быстрыми в наборе.</p>

<p>Емакс не ограничивает себя только набором текста, наоборот – берет на себя
самые разнообразные задачи, иной раз абсурдные. Каждый должен сам провести грань
– что отдавать на откуп Емаксу, а что – системным утилитам.</p>

<p>Субъективно, Емакс пребывает в более вменяемом состоянии, чем Вим. В сообществе
последнего сильны настроения в духе “взять все и переписать”. В Емаксе такого
нет. Существуют Емакс-пакеты, которые очень точно воспроизводят принципы работы
Вима – режимы, комбинации, исполнение Вим-скриптов.</p>

<h3 id="Философия-Емакса">Философия Емакса</h3>

<p>Емакс создавался для того, чтобы редактировать текстовые файлы. Однако из-за
Лиспа и развитой подсистемы ввода-вывода вышло так, что Емакс прекрасно работает
с текстом в широком смысле, неважно откуда он поступает.</p>

<p>Это значит, Емакс одинаково хорошо обработает текст, который пришел из сети или
от стороннего процесса. Поскольку в Юникс-среде основной способ передачи
информации – текст, Емакс хорошо подходит для интеграции с системой. Само
собой вышло так, что в Емаксе можно выполнять разные задачи, которые только
косвенно связаны с текстом.</p>

<h3 id="Недостатки-Когда-не-следует-использовать-Емакс">Недостатки. Когда не следует использовать Емакс</h3>

<p>Емакс не идеален. Вот в каких случаях я не рекомендую его использовать.</p>

<ul>
  <li>
    <p>Вам нужен редактор для разовых нужд, в основном копи-пасты. В этом случае
прекрасно подойдет Саблайм.</p>
  </li>
  <li>
    <p>Вы пишете на языке-платформе, неотделимой от ИДЕ. Например, C# или
Java. Пытаться доработать любой другой редактор бессмысленно.</p>
  </li>
  <li>
    <p>Порог входа выше, чем у стандартных редакторов.</p>
  </li>
  <li>
    <p>Для комфортной работы редактор нужно настроить. Настройка может длиться
годами. Главное – не увлекаться.</p>
  </li>
</ul>

<h3 id="Достоинства">Достоинства</h3>

<ul>
  <li>
    <p>Работает в разной степени со всеми известными языками и технологиями.</p>
  </li>
  <li>
    <p>Очень гибкая система обработки текста</p>
  </li>
  <li>
    <p>Мощная поддержка процессов. Простота интеграции с любым системным процессом
или утилитой, например, git, docker, psql, grep, ls и т.д.</p>
  </li>
  <li>
    <p>Конфигурирование всего и вся</p>
  </li>
  <li>
    <p>Встроенный терминал, ssh-клиент, почтовик, браузер и масса других утилит</p>
  </li>
  <li>
    <p>Золотые хиты детства – змейка, тетрис! <code class="highlighter-rouge">M-x snake</code> и <code class="highlighter-rouge">M-x tetris</code></p>
  </li>
  <li>
    <p>Единообразие. Каждый буфер, неважно, файл это или список процессов,
подчиняется основным правилам навигации и поиска. Например, вы выполнили поиск
в файле, открылся новый буфер с результатами. Теперь вы можете искать в буфере
результатов, словно в файле! В любом буфере, неважно, файл это или что-то
другое, можно настроить правила подсветки строк. Везде одинаковая навигация,
копирование и вставка. Это дико удобно. Напротив, в стандартных ИДЕ каждое
окно живет по своим особым правилам.</p>
  </li>
</ul>

<h3 id="Как-я-переходил-на-Емакс-Трудности-мотивация">Как я переходил на Емакс. Трудности, мотивация</h3>

<p>Я работаю в Емаксе третий год. Расскажу, как как пришел в него и с какими
трудностями столкнулся.</p>

<p><a href="/assets/static/emacs/emacs.png"><img src="/assets/static/emacs/emacs.png" alt="emacs" /></a></p>

<p><em>Мой Емакс сегодня. По клику большая версия. Слева – дерево файлов, посередине
– эта статья в процессе подготовки, справа – код на Схеме.</em></p>

<p>Давно я использовал Пайчарм, поскольку основной мой язык – Питон. Затем
переключился на Саблайм. Довольно быстро раскачал его плагинами и работал на
равных с теми, остался в ИДЕ.</p>

<p>Зачем нужен был этот дауншифт? Пытался обозначить список необходимых
вещей. Когда у тебя комбайн с сотней функций, трудно понять, что именно из этого
нужно. Принцип минимализма – убираем все, затем понемногу добавляем нужное.</p>

<p>В случае с Саблаймом выяснилось, что для комфортной работы достаточно 5-6
модулей для нескольких языков, интеграции с SVN и Git. Саблайм я до сих пор
считаю программой высочайшего уровня и рекомендую как легкую замену ИДЕ.</p>

<p>Но вот что беспокоило – все авторитетные для меня инженеры работали либо в
Виме, либо в Емаксе. Причем вообще без вариантов (чаще – в Емаксе, но не
суть). Это легко выяснить из интервью, статей, или просто посмотреть dotfiles на
Гитхабе. Так, Емаксом пользуются Гвидо ван Россум (создатель Питона), Джо
Армстронг (Эрланга) , Линус Торвальдс (линукса и Гита), Тед Дзюба
(предприниматель из Долины). Армин Ронахер, чей вклад в Питон неоценим,
используем Вим.</p>

<p>Полагаю, у названных людей есть деньги чтобы купить лицензии на нужные ИДЕ, но
они этого не делают. Линус как-то сказал, что готов купить любую ИДЕ, но его
пальцы уже нельзя переучить после 20 лет Емакса. Гвидо положительно отзывался о
Пайчарме, но добавил, что опять пришел к связке Емакс + pdb (самый базовый
отладчик).</p>

<p>Я пришел к нескольким выводам. Во-первых, ИДЕ действительно помогает на раннем
этапе карьеры. Но на уровне упомянутых программистов это уже не играет особой
роли. Они создали языки и компиляторы без коммерческих средств с месячной
подпиской.</p>

<p>Во-вторых, ИДЕ – это прежде всего бизнес. Адепты Джет-Брейнс расскажут, что без
ИДЕ код пишется плохо, нарушаются бизнес-процессы и страдает бизнес. Их позиция
ясна.</p>

<p>Как показывает практика, компания оставляет за собой право сменить
лицензию. Недавняя шумиха вокруг Джет-Брейнс это доказывает. Я положительно
воспринимаю идею платной подписки, но лишь для тех вещей, которые работают как
черный ящик. Например, Фотошоп и облачные хранилища. Но текстовый редактор –
последний рубеж. Он должен быть всецело моим, и точка.</p>

<p>Наконец, бывают особо критичные случаи, когда без ИДЕ человек оказывается
совершенно проф-непригоден. Один коллега в проекте впал в амнезию, когда Пайчарм
не смог открыть по клику исходники одного хитрого модуля. Другие не мыслят себя
без подсветки и автодополнения. Это полезные вещи, но плохо, когда они
становятся зависимостью.</p>

<p>Я решил переходить на Вим или Емакс, чтобы повысить уровень.</p>

<p>Если коротко, с Вимом не пошло. Занимался им две недели, было страшно
медленно. К концу второй недели я более-менее им овладел, но отходняк был
тяжелый. У меня нет никаких претензий, возможно, я что-то не так делал или
взялся за слишком трудные мануалы. По крайней мере, выучил основные команды и
могу править конфиги на серверах. В будущем планирую второй заход в Вим.</p>

<p>Напротив, с Емаксом пошло проще. Возможно, благодаря <code class="highlighter-rouge">cua-mode</code>. Это такой режим
для новичков, когда основные команды вроде копирования и вставки работают как в
классический редакторах. Долгое время я, за годы привыкший к <code class="highlighter-rouge">Ctrl-X/C/V</code>,
использовал эти же комбинации. Потом перешел на общепринятые в Емаксе.</p>

<h3 id="Установка">Установка</h3>

<ul>
  <li>
    <p>Для Мака. Либо <a href="https://emacsformacosx.com/">скачать графическую версию</a>, либо
поставить консольную версию из brew, предварительно обновив формулы.</p>
  </li>
  <li>
    <p>Для линукса. Из пакетов: apt-get, yum.</p>
  </li>
  <li>
    <p>Для Винды. <a href="https://ftp.gnu.org/gnu/emacs/windows/">Скачать бинарники</a>. На
винде осложнения в том, что Емакс нуждается в стандартных Юникс-утилитах ps,
grep, find. Понадобится какой-нибудь Cygwin или аналог.</p>
  </li>
</ul>

<p>Пакет для интеграции с Гитом под названием magit требует Емакс не ниже 24.4. Это
не очень хорошо, так как в старых Убунтах в пакетах указан 24.3. Приходится
заморачиваться со сторонними репозиториями. Для начинающих это неважно.</p>

<h3 id="Основные-положения">Основные положения</h3>

<p>Главная смысловая единица в Емаксе – буфер. Это место, где какой-то
текст. Буфер может быть связан с файлом. Буфер произошел от принципа работы с
данными на лентах. Писать каждое изменения на ленту – страшно медленно. Поэтому
считывали данные в память, обрабатывали и записывали поверх.</p>

<p>Буфер может и не быть связан с файлом. Например, это список процессов, результат
поиска в текущем буфере, греп по директории, список файлов, JSON из какого-то
урла, интерактивная справка и так далее.</p>

<p>В момент старта Емакса появляются три стандартных буфера. Это приветствие со
ссылками на документацию. Потом буфер сообщений, своего рода лог. И буфер
scratch для копипасты.</p>

<p>Этот последний буфер особый – в нем можно выполнить любой код на Лиспе и сразу
проверить, какой эффект имеет этот код.</p>

<p>В Емаксе используют особые сокращения для клавиш. C (командная клавиша) означает
Контрол, M (мета-клавиша) означает Альт. Дефис означает одновременное
нажатие. Важно помнить, что 40 лет назад клавиатуры были другие, и клавиша
Command располагалась рядом с пробелом, как сегодня на Маке. Так что Столлман не
виноват!</p>

<p><img src="/assets/static/emacs/keyboard.jpg" alt="keyboard" /></p>

<p><em>Клавиатура тех дней. Обратите внимание на расположение служебных клавиш.</em></p>

<p>Примеры:</p>

<ul>
  <li><code class="highlighter-rouge">C-x b</code> – нажать вместе Контрол и x, потом b – сменить буфер.</li>
  <li><code class="highlighter-rouge">C-x C-f</code> – нажать одновременно Контрол и x, потом одновременно Контрол и f
– открыть файл.</li>
  <li><code class="highlighter-rouge">M-g g</code> – нажать вместе Альт и g, потом еще раз g – переход на нужную строку
текущего буфера (система спросит номер).</li>
</ul>

<p>Нажатие <code class="highlighter-rouge">C-g</code> прерывает ввод текущей команды.</p>

<p>Комбинаций великое множество: одна только навигация по тексту насчитывает
несколько десятков, а есть еще манипуляции с регистром, параграфами, логической
структурой, специфичные для пакетов операции.</p>

<p>Не нужно стараться запомнить все сразу, это придет постепенно.</p>

<p>Чтобы эффективно работать в Емаксе, желательно освоить две вещи, о которых
упоминал Кирилл в вебинаре по Виму. Первое – перенести клавишу Контрол на
Капс. Это необходимо и вообще не обсуждается. Если нажимать ее в стандартном
положении, рука отвалится из-за сильного напряжения в кисти.</p>

<p>Как сделать это в Маке, <a href="/2015/10/08/2/">я уже писал</a> раньше.</p>

<p>Второе – займитесь слепой печатью. Зайдите на сайт
<a href="http://www.keybr.com/">онлайн-тренажера</a>. Зарегистрируйтесь через соц.сеть,
чтобы накапливалась статистика. Каждый день утром 15 минут печатайте
вслепую. Сначала будет бесить, но статистика покажет медленное продвижение, и
это классно. Вы должны как можно скорее избавиться от стрелочек и пользоваться
только центральной частью клавиатуры.</p>

<p><img src="/assets/static/emacs/chart.png" alt="chart" /></p>

<p><em>Один из графиков моего профиля. Он показывает, что скорость набора медленно, но
растет.</em></p>

<p>В Емаксе нет табов для открытых файлов. Это шокирует тех, кто только начал с ним
работать. Дело в том, что табы не нужны. Когда вы долго работаете, сами по себе
накапливаются открытые буферы (как мы уже знаем, в Емаксе это не только
файлы). Я никогда не выключаю ноут, а только погружаю в сон. К концу второго
месяца в Емаксе примерно 400 буферов. Представьте, что для каждого был бы таб. Я
бы просто ничего не видел из-за них.</p>

<p>Кстати, любителям ИДЕ посвящается – откройте 400 файлов и проверьте, как
поведет себя система. У моего коллеги ноут грелся так, что обжигало руку. А
Емакс потребляет 100 Мб памяти и 10% процессора.</p>

<p>Удивительно, но основные комбинации для перемещения по тексту работают много где
за пределами Емакса – например, в Хроме, почтовом агенте Мака. В Баше по
умолчанию включена раскладка Емакса.</p>

<h3 id="Конфигурирование">Конфигурирование</h3>

<p>В Емаксе настраивается все что только возможно. Существует бесконечное число
конфигов, пресетов, сборок, потому что каждый делает это под себя. У опытных
разработчиков на Гитхабе обязательно есть репозиторий с настройками редактора.</p>

<p>Не стоит допускать ошибку и разу ставить сторонние конфиги с кучей пакетов.  Вы
должны понимать, что происходит и как этим управлять. Вы должны знать назначение
каждой строчки вашего конфига. Поэтому оптимальный путь – начать с нуля,
постепенно наращивая конфиг, как жемчужину.</p>

<p>Конфиг в Емаксе – это файл с лисп-кодом. Внутри устанавливаются переменные,
вызываются команды и подключаются пакеты. Как правило, пакеты берут всю работу
на себя, нужно лишь задать им правильные настройки (флаги, пути).</p>

<p>При старте Емакс ищет файл <code class="highlighter-rouge">~/.emacs</code> . Затем – <code class="highlighter-rouge">~/.emacs.d/init.el</code>. <code class="highlighter-rouge">.el</code> –
расширение файлов на Elisp. Обратите внимание, что первый файл не содержит
расширения в имени.</p>

<p>Конфигурация не должна быть завязана на конкретную машину или файловые
пути. Желательно писать ее так, чтобы было легко перенести. Как только она
превысит десять строк, выносите в Гитхаб. Добавьте мейк-файл или шелл-скрипт,
чтобы развернуть ее парой команд.</p>

<p>Вот как ставится моя конфигурация:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Скачать репозиторий куда-то себе</span>
git clone https://github.com/igrishaev/dotfiles.git ~/somewhere

<span class="c"># скопировать папку .emacs.d в домашнюю директорию</span>
<span class="nb">cp</span> <span class="nt">-r</span> ~/somewhere/.emacs.d ~/

<span class="c"># перейти внутрь</span>
<span class="nb">cd</span> ~/.emacs.d

<span class="c"># поставить утилиту Cask</span>
make install-cask

<span class="c"># установить пакеты, перечисленные в cask-файле.</span>
<span class="c"># переменную EMACS нужно задать, если у вас в системе несколько емаксов</span>
<span class="nv">EMACS</span><span class="o">=</span>/path/to/bin/emacs make install-packages
</code></pre></div></div>

<p>Я терпеть не могу длинных навороченных конфигураций со многими файлами. При
малейших обновлениях они ломаются. Конфигурация должна быть максимально
декларативной. Только список необходимых пакетов и установка переменных.</p>

<h3 id="Коротко-о-пакетах">Коротко о пакетах</h3>

<p>Для емакса написаны тысячи пакетов, некоторые из которых тянут на полноценные
приложения, исполняемые внутри Лисп-машины.</p>

<p>Пакеты хостятся в репозиториях, у которых следующие имена – <code class="highlighter-rouge">GNU, Melpa,
Marmelade</code>. Как правило, в конфиге указывают их все. Стандартный менеджер
пакетов из поставки Емакса может устанавливать из репозиториев, но не умеет
разруливать зависимости. Поэтому используют либо пакет el-get, либо утилиту
Cask, как в моем случае. Это утилита на Питоне для сопровождения проектов на
ELisp. В ней много всего, в том числе установка зависимостей. Она переопределяет
стандартный менеджер пакетов. Вы пользуетесь как будто стандартным.</p>

<p>Основные пакеты для Емакса без привязки к конкретным языкам:</p>

<ul>
  <li><a href="https://github.com/magit/magit">magit</a> – Интеграция с Гитом</li>
  <li><a href="https://github.com/ancane/emacs-nav">nav</a> – Панель файловой навигации</li>
  <li><a href="https://github.com/auto-complete/auto-complete">auto-complete</a> –
Автодополнение из разных источников</li>
  <li><a href="https://github.com/flycheck/flycheck">flycheck</a> – проверка синтаксиса для
разных языков. Обычно нужен сабмодуль для конкретного языка</li>
  <li><a href="https://github.com/defunkt/markdown-mode">markdown-mode</a> – Маркдаун</li>
  <li><a href="https://github.com/TeMPOraL/nyan-mode">nyan-mode</a> – Нян-кот в твоем Емаксе!</li>
  <li><a href="https://github.com/rolandwalker/simpleclip">simpleclip</a> – Облегчает работу с
системным буфером обмена</li>
  <li><a href="https://github.com/joshwnj/json-mode">json-mode</a> – Подсветка и валидация
джейсона</li>
</ul>

<h3 id="Сборки-форки">Сборки, форки</h3>

<p>Я не особо осведомлен насчет сторонних сборок Емакса. Почти все время я работал
со своей конфигурацией на чистом Емаксе, чтобы понять, как все работает.</p>

<p>Как уже упоминал выше, существует XEmacs – альтернативная ветка Емакса. В ней
больше внимания уделено интерфейсу, шрифтам и внешнему виду в целом. Большинство
крупных пакетов разрабатывают так, чтобы они работали в XEmacs тоже.</p>

<p>Проект <a href="https://ergoemacs.github.io/">Эрго-Емакс</a> ставит цель создать
оптимальную клавиатурную раскладку, где наиболее востребованные функции
размещены в нужных местах. Авторы полагают, раскладка повысит производительность
и снизит усталость рук. На этом же сайте тусит сообщество, есть сборник
рецептов, снипетов и все такое.</p>

<p>Наконец, существует <a href="https://github.com/syl20bnr/spacemacs">Spacemacs</a> –
попытка взять лучшее из двух миров. Соединить механику Вима с мощью платформы
Емакса. Простыми словами, это громадный конфиг с пакетами для имитации Вима.</p>

<p>Ставил эту сборку, но не впечатлился. Кое-где были проблемы с цветовой схемой
(текст сливался с фоном), приходилось ставить недостающие пакеты. Если
возможности Вима я выключил, так как не особо им владею, то что я получил в
остатке, кроме нескучной темы?</p>

<p>Судя по репозиторию проекта, работа проделана внушительная, но я не проникся. Да
и вообще, идея смешения мне не нравится. Она наивна по своей природе. Вот есть
Руби и Питон, у них достоинства и недостатки. Давайте возьмем от каждого только
достоинства и получим идеальный язык! Или давайте Мерседес с Ауди смешаем. Или
Виндуз с Маком. Это не работает.</p>

<p>Сложилось впечатление, что в этой сборке выигрывает только Вимер. Для Емаксера
нет ничего нового. Добавлю, любая имитация всегда отстает на шаг-два от
эталона. Когда для Вима запилят новую фичу, она попадет в Spacemacs с
запозданием.</p>

<h3 id="Для-чего-я-использую-Емакс">Для чего я использую Емакс</h3>

<p>В емаксе можно делать почти все, что угодно, главное – знать меру и не стать
упоротым фанатом.</p>

<p>Надо понимать, что некоторые пакеты имеют скорее не практический, а спортивный
интерес. Например, один тип написал модуль управления кофеваркой по USB. Это
забавно, но не стоит воспринимать всерьез.</p>

<p><img src="/assets/static/emacs/xkcd.png" alt="xkcd" /></p>

<p><em>В Емаксе на все найдется команда.</em></p>

<p>Я использую Емакс для следующего:</p>

<ul>
  <li>
    <p>Программирую в Емаксе на Питоне, Кложе, Джаваскрипте, Ракете, Коммон-Лиспе. В
нем же ковыряю Хаскелл и Гоу. Под каждый язык – пакет или два для
поддержки. Питон, надо сказать, поддерживается очень хорошо. Трудность скорее
в том, какие пакеты для него выбрать из множества. Для Лиспов емакс – родная
среда.</p>
  </li>
  <li>
    <p>Редактирую структурированные файлы: Маркдаун, Json, Yaml, ini, html, css. Где
не хватает коробочных средств, тоже ставлю пакеты.</p>
  </li>
  <li>
    <p>Работаю с системами контроля версий, почти не вылезая в терминал. Смотрю
диффы, блейм, логи. Делаю и мерджу ветки в Емаксе.</p>
  </li>
  <li>
    <p>Изредка читаю онлайн-документацию во встроенном браузере EWW. Это полезно,
когда не хочешь постоянно переключаться из браузера в редактор. Делишь экран
пополам, в слева страничка с доками,справа код – удобно. Емакс умеет
проматывать соседний буфер, не переключаясь из основного.</p>
  </li>
  <li>
    <p>Планирую делать резолв конфликтов при мердже веток встроенным пакетом
emerge. Пока что использую kdiff3.</p>
  </li>
  <li>
    <p>Некоторое время, когда в команде пользовались джаббером, сидел из Емакса. Тоже
удобно, особенно когда обсуждаешь код.</p>
  </li>
  <li>
    <p>Пытался пользоваться почтой с помощью встроенного пакета Gnus – не пошло в
силу однопоточности Лисп-машины. На проверку почты уходит до 10 секунд (у меня
куча папок), за это время ничего нельзя сделать.</p>
  </li>
  <li>
    <p>Запускаю и контролирую процессы с помощью пакета prodigy. Был проект на
микросервисной архитектуре. Чтобы завести его, нужны были штук 6 фейковых
рест-сервисов. Эти заглушки было удобно поднимать и гасить прямо в Емаксе.</p>
  </li>
  <li>
    <p>Порой пользуюсь встроенным терминалом, когда лень открывать основной.</p>
  </li>
  <li>
    <p>Иногда делаю презентации в емаксе: пишу структурированный файл в разметке ORG,
который экспортируется в HTML + reveal.js. Например, вот слайды для доклада о
юнит-тестах:
<a href="https://raw.githubusercontent.com/igrishaev/talks/gh-pages/pytest.org">исходник</a>,
<a href="http://grishaev.me/talks/pytest.html">результат</a>.</p>
  </li>
  <li>
    <p>Рисую ascii-таблицы в org-mode. Параметры таблицы задаются командой. Таблица
ведет себя как лист в Экселе – можно перемещаться по ячейкам, добавлять и
удалять строки и столбцы, сортировать, вставлять формулы. Таблица автоматом
растягивается под данные в ячейках. И при этом копируется как текст. Очень
удобно для документации. Руками вы ее будете рисовать час.</p>
  </li>
</ul>

<p>Пример по шагам:</p>

<ul>
  <li><code class="highlighter-rouge">M-x org-table-create</code> – система спрашивает размер таблицы, ввожу число строк и
колонок, получаю</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|   |   |   |   |   |
|---+---+---+---+---|
|   |   |   |   |   |
</code></pre></div></div>

<ul>
  <li>Ввожу данные:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|Python   |Ruby   |Perl   |Java   |Common Lisp   |
|---+---+---+---+---|
|1   |2   |  3 | 4  |5   |
</code></pre></div></div>

<ul>
  <li>Нужен еще ряд? Набираю <code class="highlighter-rouge">M-x org-table-insert-row</code>:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|Python   |Ruby   |Perl   |Java   |Common Lisp   |
|---+---+---+---+---|
|1   |2   |  3 | 4  |5   |
|  Some long test  | 42   | foo   | bar     |    Another long text|
</code></pre></div></div>

<ul>
  <li>Все съехало, некрасиво. Набираю <code class="highlighter-rouge">M-x org-table-align</code>:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| Python         | Ruby | Perl | Java | Common Lisp       |
|----------------+------+------+------+-------------------|
| 1              |    2 | 3    | 4    | 5                 |
| Some long test |   42 | foo  | bar  | Another long text |
</code></pre></div></div>

<p>Тадам. И это даже не верхушка айсберга, а самая мелочь из того, что можно делать
в org-mode.</p>

<ul>
  <li>Возвращаюсь к нашему списку. Веду GDT – учет личных и рабочих дел. Давно хочу
написать на эту тему в блог, но пока что отдельным абзацем.</li>
</ul>

<p>Выше я уже не раз упоминал про org-mode. Это что-то вроде офисного пакета,
только для Емакса. В него входит особый язык разметки, работа с таблицами,
всевозможные экспорты.</p>

<p>В языке разметки есть особые TODO-элементы. Им можно менять состояния, причем
воркфлоу вы задаете сами в шапке файла. Им можно выставлять теги, иерархию,
писать комментарии и всякие другие вещи. Но главное, их можно привязывать ко
времени и делать повторяющимися.</p>

<p>В специальном режиме <code class="highlighter-rouge">timeline</code> Емакс покажет задачи на временной полосе, а вам
остается помечать их выполнение. При этом у вас по-прежнему текстовые файлы. Вы
можете поправить все что хотите руками, смотреть дифы.</p>

<p>Перенес все задачи в такой файл и храню его в приватном репозитории. Каждое утро
смотрю, какие задачи меня ждут и стараюсь их выполнять. Задачи можно
архивировать. Емакс вырезает их из файла и переносит в архивный файл с похожим
названием.</p>

<p>Не могу расшарить свой файл, поскольку в нем немало приватных данных, но
примерно это выглядит так:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>** DONE Sign Contract
CLOSED: [2016-03-30 Wed 12:36] SCHEDULED: &lt;2016-03-30 Wed&gt;
- CLOSING NOTE [2016-03-30 Wed 12:36] \\
  signed
** TODO Get Reports
DEADLINE: &lt;2016-06-20 Mon +3m&gt;
- CLOSING NOTE [2016-03-28 Mon 10:52] \\
  got and paid
:PROPERTIES:
:LAST_REPEAT: [2016-03-28 Mon 10:52]
:END:
** DONE IP USN
CLOSED: [2016-04-25 Mon 10:00] DEADLINE: &lt;2016-04-18 Mon&gt;
- CLOSING NOTE [2016-04-25 Mon 10:00] \\
  done
** TODO Visit some secret place
DEADLINE: &lt;2016-03-31 Thu&gt;
** DONE Sber get new card
CLOSED: [2016-04-06 Wed 15:42] SCHEDULED: &lt;2016-04-04 Mon&gt;
- CLOSING NOTE [2016-04-06 Wed 15:42] \\
  got it!
** DONE Add bank account to Paypal
CLOSED: [2016-03-25 Fri 15:39] SCHEDULED: &lt;2016-03-24 Thu&gt;
- CLOSING NOTE [2016-03-25 Fri 15:39] \\
  added
** TODO Sber Deposit
SCHEDULED: &lt;2017-02-06 Mon&gt;
** DONE Phone to Office
SCHEDULED: &lt;2016-03-01 Tue&gt;
- CLOSING NOTE [2016-03-01 Tue 15:02] \\
  phoned
- CLOSING NOTE [2016-02-24 Wed 22:52] \\
  phoned
</code></pre></div></div>

<p>Это бытовые дела – позвонить, подписать, сходить в Сбербанк. Все задачи
группирую по крупным разделам: работа, семья и дети, бизнес, блог, сторонний
проект, новинки. Почти ничего не правлю руками, все сущности создаются командами
и хоткеями.</p>

<p>На временной линии задачи выглядят так:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Friday     10 June 2016
Saturday   11 June 2016
  Scheduled:  TODO Practice Typing                                    :learning:
  Scheduled:  TODO Listen english                                     :learning:
  Scheduled:  TODO Do some secret stuff
  Scheduled:  TODO Pay for one thing
Sunday     12 June 2016
Monday     13 June 2016 W24
Tuesday    14 June 2016
  Scheduled:  TODO Another important task
  Scheduled:  TODO Listen english                                     :learning:
  Deadline:   TODO Publish announce
</code></pre></div></div>

<p>Чтобы успевать как можно больше дел, нужно сделать их регулярными и заставить
систему тебя пинать. Способ выше очень подошел.</p>

<h3 id="Ресурсы">Ресурсы</h3>

<ul>
  <li><a href="http://www.gnu.org/software/emacs/tour/">Официальный туториал</a></li>
  <li>Подробнейшая <a href="https://www.emacswiki.org/">вики</a></li>
  <li><a href="http://sachachua.com/blog/">Блог китаянки</a>, у которой конфиг Емакса длиной с
Китайскую Стену</li>
  <li>Довольно свежая <a href="https://www.masteringemacs.org/book">книжка</a></li>
  <li><a href="http://alexott.net/ru/emacs/">Серия статей</a> Алекса Отта</li>
  <li>Раздел на <a href="https://habrahabr.ru/hub/emacs/">Хабрахабре</a></li>
</ul>

  </div>

</article>

<div id="disqus_thread"></div>
<script>
    /**
    * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');

    s.src = '//igrishaev.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/igrishaev"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">igrishaev</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/i_grishaev"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">i_grishaev</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
